<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0d0d1a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="description" content="AIã§è‚Œã®è€åŒ–åº¦ã‚’åˆ†æã™ã‚‹PWAã‚¢ãƒ—ãƒª">
  <title>è‚Œè¨ºæ–­AI</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.svg">
  <link rel="stylesheet" href="css/style.css">
  <style>
    .version-badge {
      position: fixed; top: 8px; right: 10px;
      font-size: 10px; color: rgba(255,255,255,0.35);
      font-family: monospace; z-index: 9999;
      pointer-events: none; letter-spacing: 0.5px;
    }
    /* â”€â”€ Profile screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .profile-header {
      display: flex; align-items: center; gap: 12px;
      padding: 16px 20px 8px;
    }
    .profile-title {
      font-size: 1.05rem; font-weight: 700; margin: 0;
    }
    .profile-body {
      padding: 8px 20px 40px;
      display: flex; flex-direction: column;
      overflow-y: auto;
    }
    .profile-section { margin-bottom: 28px; }
    .profile-label {
      font-size: 0.82rem; color: var(--text2);
      margin-bottom: 12px; font-weight: 600;
    }
    .chip-group { display: flex; flex-wrap: wrap; gap: 10px; }
    .chip {
      padding: 9px 20px; border-radius: 24px;
      border: 1.5px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: var(--text2); font-size: 0.92rem;
      cursor: pointer; transition: all 0.18s;
      -webkit-tap-highlight-color: transparent;
    }
    .chip.selected {
      background: linear-gradient(135deg,rgba(233,30,140,0.18),rgba(155,89,182,0.18));
      border-color: rgba(233,30,140,0.7);
      color: var(--text); font-weight: 700;
    }
    .profile-divider {
      border: none; border-top: 1px solid rgba(255,255,255,0.08);
      margin: 4px 0 24px;
    }
  </style>
</head>
<body>
  <div class="version-badge">v1.1.1</div>

  <!-- Screen 1: Welcome -->
  <div id="screen-welcome" class="screen active">
    <div class="welcome-bg"></div>
    <div class="welcome-content">
      <div class="app-logo">
        <svg viewBox="0 0 120 120" class="logo-svg">
          <defs>
            <linearGradient id="lg1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#e91e8c"/>
              <stop offset="100%" stop-color="#9b59b6"/>
            </linearGradient>
          </defs>
          <ellipse cx="60" cy="58" rx="38" ry="46" fill="none" stroke="url(#lg1)" stroke-width="3"/>
          <circle cx="46" cy="46" r="5" fill="url(#lg1)"/>
          <circle cx="74" cy="46" r="5" fill="url(#lg1)"/>
          <path d="M44 72 Q60 84 76 72" fill="none" stroke="url(#lg1)" stroke-width="3" stroke-linecap="round"/>
          <line x1="10" y1="58" x2="22" y2="58" stroke="url(#lg1)" stroke-width="2" stroke-dasharray="3 2"/>
          <line x1="98" y1="58" x2="110" y2="58" stroke="url(#lg1)" stroke-width="2" stroke-dasharray="3 2"/>
        </svg>
      </div>
      <h1 class="app-title">è‚Œè¨ºæ–­ <span class="accent">AI</span></h1>
      <p class="app-subtitle">468ç‚¹ã®é¡”é¢ãƒ‡ãƒ¼ã‚¿ã‚’AIãŒè§£æ<br>ã‚ãªãŸã®è‚Œå¹´é½¢ã‚’è©³ã—ãè¨ºæ–­</p>
      <div class="features">
        <div class="feature">
          <span class="feature-icon">ğŸ”¬</span>
          <div><strong>é«˜ç²¾åº¦3Dè§£æ</strong><span>MediaPipe Face Meshã§468ç‚¹è¨ˆæ¸¬</span></div>
        </div>
        <div class="feature">
          <span class="feature-icon">ğŸ¦´</span>
          <div><strong>éª¨æ ¼ãƒ»è‚Œã‚’åˆ†é›¢åˆ†æ</strong><span>æ”¹å–„å¯èƒ½ãªè¦å› ã ã‘ã‚’ç‰¹å®š</span></div>
        </div>
        <div class="feature">
          <span class="feature-icon">ğŸ’Š</span>
          <div><strong>æ”¹å–„ãƒ—ãƒ©ãƒ³ææ¡ˆ</strong><span>ãƒ›ãƒ¼ãƒ ã‚±ã‚¢ã€œåŒ»ç™‚å‡¦ç½®ã¾ã§</span></div>
        </div>
      </div>
      <button id="btn-start" class="btn btn-primary">
        <span>è¨ºæ–­ã‚’é–‹å§‹ã™ã‚‹</span>
        <span class="btn-arrow">â†’</span>
      </button>
      <p class="privacy-notice">ğŸ”’ æ’®å½±ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«å†…ã®ã¿ã§å‡¦ç†ã€‚å¤–éƒ¨é€ä¿¡ãªã—</p>
    </div>
  </div>

  <!-- Screen 1.5: Profile (age / gender) -->
  <div id="screen-profile" class="screen">
    <div class="profile-header">
      <button id="btn-back-profile" class="btn-icon-round">â†</button>
      <h2 class="profile-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›</h2>
    </div>
    <div class="profile-body">
      <p style="font-size:0.85rem;color:var(--text2);margin-bottom:24px;line-height:1.6;">
        å…¥åŠ›æƒ…å ±ã‚’ã‚‚ã¨ã«ã€å®Ÿå¹´é½¢ã¨ã®æ¯”è¼ƒã‚„æ€§åˆ¥è£œæ­£ã‚’è¡Œã„ã¾ã™ã€‚
      </p>

      <div class="profile-section">
        <p class="profile-label">ã‚ãªãŸã®å¹´é½¢å±¤</p>
        <div class="chip-group" id="age-chips">
          <button class="chip" data-age-value="17" data-age-label="10ä»£">10ä»£</button>
          <button class="chip" data-age-value="25" data-age-label="20ä»£">20ä»£</button>
          <button class="chip selected" data-age-value="35" data-age-label="30ä»£">30ä»£</button>
          <button class="chip" data-age-value="45" data-age-label="40ä»£">40ä»£</button>
          <button class="chip" data-age-value="55" data-age-label="50ä»£">50ä»£</button>
          <button class="chip" data-age-value="65" data-age-label="60ä»£ä»¥ä¸Š">60ä»£ä»¥ä¸Š</button>
        </div>
      </div>

      <hr class="profile-divider">

      <div class="profile-section">
        <p class="profile-label">æ€§åˆ¥</p>
        <div class="chip-group" id="gender-chips">
          <button class="chip selected" data-gender="female">å¥³æ€§</button>
          <button class="chip" data-gender="male">ç”·æ€§</button>
          <button class="chip" data-gender="other">å›ç­”ã—ãªã„</button>
        </div>
      </div>

      <button id="btn-confirm-profile" class="btn btn-primary" style="margin-top:8px">
        <span>è¨ºæ–­ã‚’é–‹å§‹ã™ã‚‹</span>
        <span class="btn-arrow">â†’</span>
      </button>
      <p class="privacy-notice" style="margin-top:16px;">ğŸ”’ å…¥åŠ›æƒ…å ±ã¯ç«¯æœ«å†…ã®ã¿ã§ä½¿ç”¨ã•ã‚Œã¾ã™</p>
    </div>
  </div>

  <!-- Screen 2: Camera -->
  <div id="screen-camera" class="screen">
    <div class="camera-header">
      <button id="btn-back-camera" class="btn-icon-round">â†</button>
      <div class="step-progress">
        <div class="step-node active" id="node-0">1</div>
        <div class="step-line" id="line-0"></div>
        <div class="step-node" id="node-1">2</div>
        <div class="step-line" id="line-1"></div>
        <div class="step-node" id="node-2">3</div>
      </div>
      <span id="step-label" class="step-label">1 / 3</span>
    </div>
    <div class="instruction-card" id="instruction-card">
      <div id="pose-emoji" class="pose-emoji">ğŸ˜</div>
      <div class="instruction-text">
        <h2 id="step-title">æ­£é¢ãƒ»ç„¡è¡¨æƒ…</h2>
        <p id="step-desc">ã‚«ãƒ¡ãƒ©ã‚’é¡”ã®æ­£é¢ã«å‘ã‘ã€<br>ç„¡è¡¨æƒ…ã®ã¾ã¾é™æ­¢ã—ã¦ãã ã•ã„</p>
      </div>
    </div>
    <div class="camera-viewport">
      <video id="video" autoplay playsinline muted></video>
      <canvas id="overlay-canvas"></canvas>
      <div class="face-oval-guide">
        <svg viewBox="0 0 100 100" preserveAspectRatio="none">
          <ellipse cx="50" cy="50" rx="32" ry="42"
            fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="0.5" stroke-dasharray="3 2"/>
        </svg>
      </div>
      <div id="face-feedback" class="face-feedback detecting">
        <span id="feedback-dot" class="feedback-dot"></span>
        <span id="feedback-text">é¡”ã‚’æ¤œå‡ºä¸­...</span>
      </div>
    </div>
    <div class="camera-controls">
      <p id="capture-hint" class="capture-hint">é¡”ã‚’æ å†…ã«åˆã‚ã›ã¦ãã ã•ã„</p>
      <div class="capture-row">
        <div class="thumb-slot" id="thumb-0"></div>
        <button id="btn-capture" class="btn-shutter" disabled>
          <div class="shutter-ring"></div>
          <div class="shutter-center"></div>
        </button>
        <div class="thumb-slot" id="thumb-1"></div>
      </div>
    </div>
  </div>

  <!-- Screen 3: Processing -->
  <div id="screen-processing" class="screen">
    <div class="processing-center">
      <div class="ai-sphere">
        <div class="sphere-glow"></div>
        <div class="sphere-icon">ğŸ§ </div>
        <div class="ring r1"><span class="ring-dot"></span></div>
        <div class="ring r2"><span class="ring-dot"></span></div>
      </div>
      <h2 class="processing-title">AIè§£æä¸­...</h2>
      <div class="progress-bar-wrap">
        <div class="progress-track">
          <div id="progress-fill" class="progress-fill"></div>
        </div>
        <span id="progress-pct">0%</span>
      </div>
      <ul class="analysis-log" id="analysis-log">
        <li id="log-model">â¬œ AIãƒ¢ãƒ‡ãƒ«æº–å‚™</li>
        <li id="log-detect">â¬œ é¡”ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æ¤œå‡º (3æš)</li>
        <li id="log-nasolabial">â¬œ æ³•ä»¤ç·šè§£æ</li>
        <li id="log-marionette">â¬œ ãƒãƒªã‚ªãƒãƒƒãƒˆãƒ©ã‚¤ãƒ³è§£æ</li>
        <li id="log-cheek">â¬œ é ¬ã®ãŸã‚‹ã¿ãƒ»å¼¾åŠ›è§£æ</li>
        <li id="log-wrinkle">â¬œ ã‚·ãƒ¯ãƒ»ç›®å°»ãƒ»çœ‰é–“ãƒ»ã¾ã¶ãŸã®æ¤œå‡º</li>
        <li id="log-bone">â¬œ éª¨æ ¼æ§‹é€ ã®è©•ä¾¡</li>
        <li id="log-chin">â¬œ é¡ã®ãŸã‚‹ã¿è§£æï¼ˆçœŸä¸‹æ’®å½±ï¼‰</li>
        <li id="log-score">â¬œ è‚Œå¹´é½¢ã‚¹ã‚³ã‚¢ç®—å‡º</li>
      </ul>
    </div>
  </div>

  <!-- Screen 4: Results -->
  <div id="screen-results" class="screen">
    <div class="results-header">
      <h1>è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ</h1>
      <div class="header-btns">
        <button id="btn-share" class="btn-sm" title="ã‚·ã‚§ã‚¢">ğŸ“¤</button>
        <button id="btn-retry" class="btn-sm" title="å†è¨ºæ–­">ğŸ”„</button>
      </div>
    </div>
    <div id="results-body" class="results-body"></div>
  </div>

  <!-- Loading Modal -->
  <div id="modal-loading" class="modal hidden">
    <div class="modal-box">
      <div class="spinner"></div>
      <p id="modal-text">AIãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
      <p class="modal-sub">åˆå›ã¯30ç§’ã»ã©ã‹ã‹ã‚Šã¾ã™</p>
    </div>
  </div>

  <!-- Error Modal -->
  <div id="modal-error" class="modal hidden">
    <div class="modal-box">
      <div class="error-icon">âš ï¸</div>
      <h3 id="error-title">ã‚¨ãƒ©ãƒ¼</h3>
      <p id="error-msg"></p>
      <button id="btn-error-ok" class="btn btn-primary" style="margin-top:16px">OK</button>
    </div>
  </div>

  <!-- TF.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@1.0.5/dist/face-landmarks-detection.js"></script>

  <!-- App modules -->
  <script src="js/analyzers/nasolabialAnalyzer.js"></script>
  <script src="js/analyzers/marionetteAnalyzer.js"></script>
  <script src="js/analyzers/chinSagAnalyzer.js"></script>
  <script src="js/analyzers/cheekAnalyzer.js"></script>
  <script src="js/analyzers/boneStructureAnalyzer.js"></script>
  <script src="js/analyzers/wrinkleAnalyzer.js"></script>
  <script src="js/analyzers/skinAgeScorer.js"></script>
  <script src="js/results/reportGenerator.js"></script>
  <script src="js/faceDetector.js"></script>
  <script src="js/camera.js"></script>
  <script src="js/app.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('SW registered:', reg.scope))
          .catch(err => console.log('SW error:', err));
      });
    }
  </script>
</body>
</html>
